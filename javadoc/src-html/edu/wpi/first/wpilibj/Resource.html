<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>Source code</title>
<meta name="description" content="source: package: edu.wpi.first.wpilibj, class: Resource">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body class="source">
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">// Copyright (c) FIRST and other WPILib contributors.</a>
<span class="sourceLineNo">002</span><a id="line.2">// Open Source Software; you can modify and/or share it under the terms of</a>
<span class="sourceLineNo">003</span><a id="line.3">// the WPILib BSD license file in the root directory of this project.</a>
<span class="sourceLineNo">004</span><a id="line.4"></a>
<span class="sourceLineNo">005</span><a id="line.5">package edu.wpi.first.wpilibj;</a>
<span class="sourceLineNo">006</span><a id="line.6"></a>
<span class="sourceLineNo">007</span><a id="line.7">import edu.wpi.first.hal.util.AllocationException;</a>
<span class="sourceLineNo">008</span><a id="line.8">import edu.wpi.first.hal.util.CheckedAllocationException;</a>
<span class="sourceLineNo">009</span><a id="line.9"></a>
<span class="sourceLineNo">010</span><a id="line.10">/**</a>
<span class="sourceLineNo">011</span><a id="line.11"> * Track resources in the program. The Resource class is a convenient way of keeping track of</a>
<span class="sourceLineNo">012</span><a id="line.12"> * allocated arbitrary resources in the program. Resources are just indices that have a lower and</a>
<span class="sourceLineNo">013</span><a id="line.13"> * upper bound that are tracked by this class. In the library they are used for tracking allocation</a>
<span class="sourceLineNo">014</span><a id="line.14"> * of hardware channels but this is purely arbitrary. The resource class does not do any actual</a>
<span class="sourceLineNo">015</span><a id="line.15"> * allocation, but simply tracks if a given index is currently in use.</a>
<span class="sourceLineNo">016</span><a id="line.16"> *</a>
<span class="sourceLineNo">017</span><a id="line.17"> * &lt;p&gt;&lt;b&gt;WARNING:&lt;/b&gt; this should only be statically allocated. When the program loads into memory</a>
<span class="sourceLineNo">018</span><a id="line.18"> * all the static constructors are called. At that time a linked list of all the "Resources" is</a>
<span class="sourceLineNo">019</span><a id="line.19"> * created. Then, when the program actually starts - in the Robot constructor, all resources are</a>
<span class="sourceLineNo">020</span><a id="line.20"> * initialized. This ensures that the program is restartable in memory without having to</a>
<span class="sourceLineNo">021</span><a id="line.21"> * unload/reload.</a>
<span class="sourceLineNo">022</span><a id="line.22"> */</a>
<span class="sourceLineNo">023</span><a id="line.23">public final class Resource {</a>
<span class="sourceLineNo">024</span><a id="line.24">  private static Resource resourceList;</a>
<span class="sourceLineNo">025</span><a id="line.25">  private final boolean[] m_numAllocated;</a>
<span class="sourceLineNo">026</span><a id="line.26">  private final int m_size;</a>
<span class="sourceLineNo">027</span><a id="line.27">  private final Resource m_nextResource;</a>
<span class="sourceLineNo">028</span><a id="line.28"></a>
<span class="sourceLineNo">029</span><a id="line.29">  /** Clears all allocated resources. */</a>
<span class="sourceLineNo">030</span><a id="line.30">  public static void restartProgram() {</a>
<span class="sourceLineNo">031</span><a id="line.31">    for (Resource r = Resource.resourceList; r != null; r = r.m_nextResource) {</a>
<span class="sourceLineNo">032</span><a id="line.32">      for (int i = 0; i &lt; r.m_size; i++) {</a>
<span class="sourceLineNo">033</span><a id="line.33">        r.m_numAllocated[i] = false;</a>
<span class="sourceLineNo">034</span><a id="line.34">      }</a>
<span class="sourceLineNo">035</span><a id="line.35">    }</a>
<span class="sourceLineNo">036</span><a id="line.36">  }</a>
<span class="sourceLineNo">037</span><a id="line.37"></a>
<span class="sourceLineNo">038</span><a id="line.38">  /**</a>
<span class="sourceLineNo">039</span><a id="line.39">   * Allocate storage for a new instance of Resource. Allocate a bool array of values that will get</a>
<span class="sourceLineNo">040</span><a id="line.40">   * initialized to indicate that no resources have been allocated yet. The indices of the resources</a>
<span class="sourceLineNo">041</span><a id="line.41">   * are 0..size-1.</a>
<span class="sourceLineNo">042</span><a id="line.42">   *</a>
<span class="sourceLineNo">043</span><a id="line.43">   * @param size The number of blocks to allocate</a>
<span class="sourceLineNo">044</span><a id="line.44">   */</a>
<span class="sourceLineNo">045</span><a id="line.45">  public Resource(final int size) {</a>
<span class="sourceLineNo">046</span><a id="line.46">    m_size = size;</a>
<span class="sourceLineNo">047</span><a id="line.47">    m_numAllocated = new boolean[size];</a>
<span class="sourceLineNo">048</span><a id="line.48">    for (int i = 0; i &lt; size; i++) {</a>
<span class="sourceLineNo">049</span><a id="line.49">      m_numAllocated[i] = false;</a>
<span class="sourceLineNo">050</span><a id="line.50">    }</a>
<span class="sourceLineNo">051</span><a id="line.51">    m_nextResource = Resource.resourceList;</a>
<span class="sourceLineNo">052</span><a id="line.52">    Resource.resourceList = this;</a>
<span class="sourceLineNo">053</span><a id="line.53">  }</a>
<span class="sourceLineNo">054</span><a id="line.54"></a>
<span class="sourceLineNo">055</span><a id="line.55">  /**</a>
<span class="sourceLineNo">056</span><a id="line.56">   * Allocate a resource. When a resource is requested, mark it allocated. In this case, a free</a>
<span class="sourceLineNo">057</span><a id="line.57">   * resource value within the range is located and returned after it is marked allocated.</a>
<span class="sourceLineNo">058</span><a id="line.58">   *</a>
<span class="sourceLineNo">059</span><a id="line.59">   * @return The index of the allocated block.</a>
<span class="sourceLineNo">060</span><a id="line.60">   * @throws CheckedAllocationException If there are no resources available to be allocated.</a>
<span class="sourceLineNo">061</span><a id="line.61">   */</a>
<span class="sourceLineNo">062</span><a id="line.62">  public int allocate() throws CheckedAllocationException {</a>
<span class="sourceLineNo">063</span><a id="line.63">    for (int i = 0; i &lt; m_size; i++) {</a>
<span class="sourceLineNo">064</span><a id="line.64">      if (!m_numAllocated[i]) {</a>
<span class="sourceLineNo">065</span><a id="line.65">        m_numAllocated[i] = true;</a>
<span class="sourceLineNo">066</span><a id="line.66">        return i;</a>
<span class="sourceLineNo">067</span><a id="line.67">      }</a>
<span class="sourceLineNo">068</span><a id="line.68">    }</a>
<span class="sourceLineNo">069</span><a id="line.69">    throw new CheckedAllocationException("No available resources");</a>
<span class="sourceLineNo">070</span><a id="line.70">  }</a>
<span class="sourceLineNo">071</span><a id="line.71"></a>
<span class="sourceLineNo">072</span><a id="line.72">  /**</a>
<span class="sourceLineNo">073</span><a id="line.73">   * Allocate a specific resource value. The user requests a specific resource value, i.e. channel</a>
<span class="sourceLineNo">074</span><a id="line.74">   * number, and it is verified unallocated, then returned.</a>
<span class="sourceLineNo">075</span><a id="line.75">   *</a>
<span class="sourceLineNo">076</span><a id="line.76">   * @param index The resource to allocate</a>
<span class="sourceLineNo">077</span><a id="line.77">   * @return The index of the allocated block</a>
<span class="sourceLineNo">078</span><a id="line.78">   * @throws CheckedAllocationException If there are no resources available to be allocated.</a>
<span class="sourceLineNo">079</span><a id="line.79">   */</a>
<span class="sourceLineNo">080</span><a id="line.80">  public int allocate(final int index) throws CheckedAllocationException {</a>
<span class="sourceLineNo">081</span><a id="line.81">    if (index &gt;= m_size || index &lt; 0) {</a>
<span class="sourceLineNo">082</span><a id="line.82">      throw new CheckedAllocationException("Index " + index + " out of range");</a>
<span class="sourceLineNo">083</span><a id="line.83">    }</a>
<span class="sourceLineNo">084</span><a id="line.84">    if (m_numAllocated[index]) {</a>
<span class="sourceLineNo">085</span><a id="line.85">      throw new CheckedAllocationException("Resource at index " + index + " already allocated");</a>
<span class="sourceLineNo">086</span><a id="line.86">    }</a>
<span class="sourceLineNo">087</span><a id="line.87">    m_numAllocated[index] = true;</a>
<span class="sourceLineNo">088</span><a id="line.88">    return index;</a>
<span class="sourceLineNo">089</span><a id="line.89">  }</a>
<span class="sourceLineNo">090</span><a id="line.90"></a>
<span class="sourceLineNo">091</span><a id="line.91">  /**</a>
<span class="sourceLineNo">092</span><a id="line.92">   * Free an allocated resource. After a resource is no longer needed, for example a destructor is</a>
<span class="sourceLineNo">093</span><a id="line.93">   * called for a channel assignment class, this method will release the resource value, so it can</a>
<span class="sourceLineNo">094</span><a id="line.94">   * be reused somewhere else in the program.</a>
<span class="sourceLineNo">095</span><a id="line.95">   *</a>
<span class="sourceLineNo">096</span><a id="line.96">   * @param index The index of the resource to free.</a>
<span class="sourceLineNo">097</span><a id="line.97">   */</a>
<span class="sourceLineNo">098</span><a id="line.98">  public void free(final int index) {</a>
<span class="sourceLineNo">099</span><a id="line.99">    if (!m_numAllocated[index]) {</a>
<span class="sourceLineNo">100</span><a id="line.100">      throw new AllocationException("No resource available to be freed");</a>
<span class="sourceLineNo">101</span><a id="line.101">    }</a>
<span class="sourceLineNo">102</span><a id="line.102">    m_numAllocated[index] = false;</a>
<span class="sourceLineNo">103</span><a id="line.103">  }</a>
<span class="sourceLineNo">104</span><a id="line.104">}</a>




























































</pre>
</div>
</main>
</body>
</html>
