<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WPILibC++: /home/runner/work/allwpilib/allwpilib/apriltag/src/main/native/thirdparty/apriltag/include/common/homography.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="wpilib-128.png"/></td>
  <td id="projectalign">
   <div id="projectname">WPILibC++<span id="projectnumber">&#160;2025.1.1-beta-1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('homography_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">homography.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="matd_8h_source.html">matd.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="zarray_8h_source.html">zarray.h</a>&quot;</code><br />
</div>
<p><a href="homography_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0ce589ae8483ea7308cf60a1b5126d1e" id="r_a0ce589ae8483ea7308cf60a1b5126d1e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0ce589ae8483ea7308cf60a1b5126d1e">HOMOGRAPHY_COMPUTE_FLAG_INVERSE</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a0ce589ae8483ea7308cf60a1b5126d1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a 3x3 homography matrix and the focal lengths of the camera, compute the pose of the tag.  <br /></td></tr>
<tr class="separator:a0ce589ae8483ea7308cf60a1b5126d1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe7eb3d7e542eff435d0efd4fd634f87" id="r_afe7eb3d7e542eff435d0efd4fd634f87"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe7eb3d7e542eff435d0efd4fd634f87">HOMOGRAPHY_COMPUTE_FLAG_SVD</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:afe7eb3d7e542eff435d0efd4fd634f87"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0efc8ed8a1bb51217b6f1d3582a6efdc" id="r_a0efc8ed8a1bb51217b6f1d3582a6efdc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmatd__t.html">matd_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0efc8ed8a1bb51217b6f1d3582a6efdc">homography_compute</a> (<a class="el" href="zarray_8h.html#af429d8225958865fc14ea0ddcc7c0b06">zarray_t</a> *correspondences, int flags)</td></tr>
<tr class="separator:a0efc8ed8a1bb51217b6f1d3582a6efdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac10ec41cad27f7401a7cf906b588b69f" id="r_ac10ec41cad27f7401a7cf906b588b69f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac10ec41cad27f7401a7cf906b588b69f">homography_project</a> (const <a class="el" href="structmatd__t.html">matd_t</a> *H, double x, double y, double *ox, double *oy)</td></tr>
<tr class="separator:ac10ec41cad27f7401a7cf906b588b69f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73edef91fccdaf522d96332a3f22084d" id="r_a73edef91fccdaf522d96332a3f22084d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmatd__t.html">matd_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73edef91fccdaf522d96332a3f22084d">homography_to_pose</a> (const <a class="el" href="structmatd__t.html">matd_t</a> *H, double fx, double fy, double cx, double cy)</td></tr>
<tr class="separator:a73edef91fccdaf522d96332a3f22084d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f54356f12d7283ee3aeba0edf0f1b92" id="r_a7f54356f12d7283ee3aeba0edf0f1b92"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmatd__t.html">matd_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7f54356f12d7283ee3aeba0edf0f1b92">homography_to_model_view</a> (const <a class="el" href="structmatd__t.html">matd_t</a> *H, double F, double G, double A, double B)</td></tr>
<tr class="separator:a7f54356f12d7283ee3aeba0edf0f1b92"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a0ce589ae8483ea7308cf60a1b5126d1e" name="a0ce589ae8483ea7308cf60a1b5126d1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ce589ae8483ea7308cf60a1b5126d1e">&#9670;&#160;</a></span>HOMOGRAPHY_COMPUTE_FLAG_INVERSE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HOMOGRAPHY_COMPUTE_FLAG_INVERSE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given a 3x3 homography matrix and the focal lengths of the camera, compute the pose of the tag. </p>
<p>The focal lengths should be given in pixels. For example, if the camera's focal length is twice the width of the sensor, and the sensor is 600 pixels across, the focal length in pixels is 2*600. Note that the focal lengths in the fx and fy direction will be approximately equal for most lenses, and is not a function of aspect ratio.</p>
<p>Theory: The homography matrix is the product of the camera projection matrix and the tag's pose matrix (the matrix that projects points from the tag's local coordinate system to the camera's coordinate frame).</p>
<p>[ h00 h01 h02 h03] = [ fx 0 cx 0 ] [ R00 R01 R02 TX ] [ h10 h11 h12 h13] = [ 0 fy cy 0 ] [ R10 R11 R12 TY ] [ h20 h21 h22 h23] = [ 0 0 s 0 ] [ R20 R21 R22 TZ ] [ 0 0 0 1 ]</p>
<p>fx is the focal length in the x direction of the camera (typically measured in pixels), fy is the focal length. cx and cy give the focal center (usually the middle of the image), and s is either +1 or -1, depending on the conventions you use. (We use 1.)</p>
<p>When observing a tag, the points we project in world space all have z=0, so we can form a 3x3 matrix by eliminating the 3rd column of the pose matrix.</p>
<p>[ h00 h01 h02 ] = [ fx 0 cx 0 ] [ R00 R01 TX ] [ h10 h11 h12 ] = [ 0 fy cy 0 ] [ R10 R11 TY ] [ h20 h21 h22 ] = [ 0 0 s 0 ] [ R20 R21 TZ ] [ 0 0 1 ]</p>
<p>(note that these h's are different from the ones above.)</p>
<p>We can multiply the right-hand side to yield a set of equations relating the values of h to the values of the pose matrix.</p>
<p>There are two wrinkles. The first is that the homography matrix is known only up to scale. We recover the unknown scale by constraining the magnitude of the first two columns of the pose matrix to be 1. We use the geometric average scale. The sign of the scale factor is recovered by constraining the observed tag to be in front of the camera. Once scaled, we recover the first two colmuns of the rotation matrix. The third column is the cross product of these.</p>
<p>The second wrinkle is that the computed rotation matrix might not be exactly orthogonal, so we perform a polar decomposition to find a good pure rotation approximation.</p>
<p>Tagsize is the size of the tag in your desired units. I.e., if your tag measures 0.25m along the side, your tag size is 0.25. (The homography is computed in terms of <em>half</em> the tag size, i.e., that a tag is 2 units wide as it spans from -1 to +1, but this code makes the appropriate adjustment.)</p>
<p>A note on signs:</p>
<p>The code below incorporates no additional negative signs, but respects the sign of any parameters that you pass in. Flipping the signs allows you to modify the projection to suit a wide variety of conditions.</p>
<p>In the "pure geometry" projection matrix, the image appears upside down; i.e., the x and y coordinates on the left hand side are the opposite of those on the right of the camera projection matrix. This would happen for all parameters positive: recall that points in front of the camera have negative Z values, which will cause the sign of all points to flip.</p>
<p>However, most cameras flip things so that the image appears "right side up" as though you were looking through the lens directly. This means that the projected points should have the same sign as the points on the right of the camera projection matrix. To achieve this, flip fx and fy.</p>
<p>One further complication: cameras typically put y=0 at the top of the image, instead of the bottom. Thus you generally want to flip y yet again (so it's now positive again).</p>
<p>General advice: you probably want fx negative, fy positive, cx and cy positive, and s=1. </p>

</div>
</div>
<a id="afe7eb3d7e542eff435d0efd4fd634f87" name="afe7eb3d7e542eff435d0efd4fd634f87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe7eb3d7e542eff435d0efd4fd634f87">&#9670;&#160;</a></span>HOMOGRAPHY_COMPUTE_FLAG_SVD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HOMOGRAPHY_COMPUTE_FLAG_SVD&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0efc8ed8a1bb51217b6f1d3582a6efdc" name="a0efc8ed8a1bb51217b6f1d3582a6efdc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0efc8ed8a1bb51217b6f1d3582a6efdc">&#9670;&#160;</a></span>homography_compute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmatd__t.html">matd_t</a> * homography_compute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="zarray_8h.html#af429d8225958865fc14ea0ddcc7c0b06">zarray_t</a> *</td>          <td class="paramname"><span class="paramname"><em>correspondences</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac10ec41cad27f7401a7cf906b588b69f" name="ac10ec41cad27f7401a7cf906b588b69f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac10ec41cad27f7401a7cf906b588b69f">&#9670;&#160;</a></span>homography_project()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void homography_project </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structmatd__t.html">matd_t</a> *</td>          <td class="paramname"><span class="paramname"><em>H</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>x</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>y</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *</td>          <td class="paramname"><span class="paramname"><em>ox</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *</td>          <td class="paramname"><span class="paramname"><em>oy</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a7f54356f12d7283ee3aeba0edf0f1b92" name="a7f54356f12d7283ee3aeba0edf0f1b92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f54356f12d7283ee3aeba0edf0f1b92">&#9670;&#160;</a></span>homography_to_model_view()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmatd__t.html">matd_t</a> * homography_to_model_view </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structmatd__t.html">matd_t</a> *</td>          <td class="paramname"><span class="paramname"><em>H</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>F</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>G</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>A</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>B</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a73edef91fccdaf522d96332a3f22084d" name="a73edef91fccdaf522d96332a3f22084d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73edef91fccdaf522d96332a3f22084d">&#9670;&#160;</a></span>homography_to_pose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmatd__t.html">matd_t</a> * homography_to_pose </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structmatd__t.html">matd_t</a> *</td>          <td class="paramname"><span class="paramname"><em>H</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>fx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>fy</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>cx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>cy</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bce03949b0889f5b77e9e810e79dfd7d.html">thirdparty</a></li><li class="navelem"><a class="el" href="dir_ff0062bb8776854a1feb511e7a5035f7.html">apriltag</a></li><li class="navelem"><a class="el" href="dir_4f37ec3afec411c33430786613d06e76.html">include</a></li><li class="navelem"><a class="el" href="dir_6324afc825a598ce4fef60a1f900074d.html">common</a></li><li class="navelem"><a class="el" href="homography_8h.html">homography.h</a></li>
    <li class="footer">Generated on Sun Oct 13 2024 07:18:58 for WPILibC++ by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
